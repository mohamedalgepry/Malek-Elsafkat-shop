# ูุธุงู ุงูุฅุดุนุงุฑุงุช - ุฏููู ุงูุงุณุชุฎุฏุงู

## โ ุชู ุฅูุดุงุก ูุธุงู ุฅุดุนุงุฑุงุช ูุชูุงูู

### ุงูููููุงุช ุงููููุดุฃุฉ:

#### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ููู:** `database/notifications.sql`
- **ุงูุฌุฏูู:** `notifications`
- **ุงูุญููู:**
  - `id` - ูุนุฑู ุงูุฅุดุนุงุฑ
  - `type` - ููุน ุงูุฅุดุนุงุฑ (new_order, order_status, low_stock)
  - `title` - ุนููุงู ุงูุฅุดุนุงุฑ
  - `message` - ูุต ุงูุฅุดุนุงุฑ
  - `link` - ุฑุงุจุท ุงูุฅุดุนุงุฑ
  - `order_id` - ูุนุฑู ุงูุทูุจ ุงููุฑุชุจุท
  - `is_read` - ุญุงูุฉ ุงููุฑุงุกุฉ
  - `created_at` - ุชุงุฑูุฎ ุงูุฅูุดุงุก

#### 2. Model
- **ููู:** `app/models/Notification.php`
- **ุงูุฏูุงู:**
  - `create()` - ุฅูุดุงุก ุฅุดุนุงุฑ ุฌุฏูุฏ
  - `getAll()` - ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช
  - `getUnread()` - ุฌูุจ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
  - `getUnreadCount()` - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
  - `markAsRead()` - ุชุนููู ุฅุดุนุงุฑ ูููุฑูุก
  - `markAllAsRead()` - ุชุนููู ุงููู ูููุฑูุก
  - `delete()` - ุญุฐู ุฅุดุนุงุฑ
  - `deleteOld()` - ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ

#### 3. Controller
- **ููู:** `app/controllers/AdminController.php`
- **ุงูุฏูุงู ุงููุถุงูุฉ:**
  - `getNotifications()` - API ูุฌูุจ ุงูุฅุดุนุงุฑุงุช
  - `markNotificationRead()` - ุชุนููู ุฅุดุนุงุฑ ูููุฑูุก
  - `markAllNotificationsRead()` - ุชุนููู ุงููู ูููุฑูุก

#### 4. Routes
- **GET:** `/admin/notifications` - ุฌูุจ ุงูุฅุดุนุงุฑุงุช
- **POST:** `/admin/notifications/read/{id}` - ุชุนููู ูููุฑูุก
- **POST:** `/admin/notifications/read-all` - ุชุนููู ุงููู ูููุฑูุก

#### 5. Frontend
- **Header:** `app/views/admin/layouts/header.php` - ุฃููููุฉ ุงูุฅุดุนุงุฑุงุช
- **JavaScript:** `public/assets/js/notifications.js` - ููุทู ุงูุฅุดุนุงุฑุงุช
- **CSS:** `public/assets/css/admin.css` - ุชูุณูู ุงูุฅุดุนุงุฑุงุช

#### 6. ุงูุชูุงูู
- **ููู:** `app/controllers/CheckoutController.php`
- ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏุ ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ุชููุงุฆูุงู

---

## ๐ ุฎุทูุงุช ุงูุชูุนูู

### 1. ุฅูุดุงุก ุฌุฏูู ุงูุฅุดุนุงุฑุงุช

ุงูุชุญ **phpMyAdmin** ูููุฐ:
```
database/notifications.sql
```

ุฃู ููุฐ ูุฐุง ุงูุฃูุฑ:
```sql
CREATE TABLE IF NOT EXISTS notifications (
    id INT PRIMARY KEY AUTO_INCREMENT,
    type VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    link VARCHAR(255) NULL,
    order_id INT NULL,
    is_read BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    INDEX idx_read (is_read),
    INDEX idx_created (created_at),
    INDEX idx_order (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 2. ุชุญุฏูุซ ุงูุตูุญุฉ

- ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
- ููุท ุญุฏูุซ ุตูุญุฉ ููุญุฉ ุงูุชุญูู

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุฏูุฑ:

1. **ุนุฑุถ ุงูุฅุดุนุงุฑุงุช:**
   - ุงุถุบุท ุนูู ุฃููููุฉ ุงูุฌุฑุณ ๐ ูู ุฃุนูู ููุญุฉ ุงูุชุญูู
   - ุณุชุธูุฑ ูุงุฆูุฉ ููุณุฏูุฉ ุจุงูุฅุดุนุงุฑุงุช

2. **ูุฑุงุกุฉ ุฅุดุนุงุฑ:**
   - ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ ูุชุนูููู ูููุฑูุก
   - ุณูุชู ูุชุญ ุงูุฑุงุจุท ุงููุฑุชุจุท (ุฅู ูุฌุฏ)

3. **ุชุนููู ุงููู ูููุฑูุก:**
   - ุงุถุบุท ุนูู "ุชุนููู ุงููู ูููุฑูุก" ูู ุฑุฃุณ ุงููุงุฆูุฉ

4. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:**
   - ูุชู ูุญุต ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ ูู 30 ุซุงููุฉ
   - ุตูุช ุชูุจูู ุนูุฏ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ

---

## ๐จ ุงููููุฒุงุช

### โ ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
- ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ููุฑุงู ุนูุฏ ูุตูู ุทูุจ ุฌุฏูุฏ
- ูุธูุฑ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ุนูู ุฃููููุฉ ุงูุฌุฑุณ

### โ ุตูุช ุงูุชูุจูู
- ุตูุช ุชูุจูู ุนูุฏ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ
- ูุนูู ุชููุงุฆูุงู ูู ุงูุฎูููุฉ

### โ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช
- **new_order** - ุทูุจ ุฌุฏูุฏ (ุฃุฎุถุฑ)
- **order_status** - ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ (ุฃุฒุฑู)
- **low_stock** - ููุงุฐ ุงููุฎุฒูู (ุจุฑุชูุงูู)

### โ ุงูุชุญุฏูุซ ุงูุชููุงุฆู
- ูุญุต ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ ูู 30 ุซุงููุฉ
- ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุงูุตูุญุฉ ูุฏููุงู

### โ ุงูุฑูุงุจุท ุงููุจุงุดุฑุฉ
- ูู ุฅุดุนุงุฑ ูุญุชูู ุนูู ุฑุงุจุท ูุจุงุดุฑ ููุทูุจ
- ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ ููุงูุชูุงู ูุจุงุดุฑุฉ

---

## ๐ง ุงูุชุฎุตูุต

### ุฅุถุงูุฉ ููุน ุฅุดุนุงุฑ ุฌุฏูุฏ:

```php
$notificationModel = new Notification();
$notificationModel->create(
    'low_stock',  // ุงูููุน
    'ุชุญุฐูุฑ: ููุงุฐ ุงููุฎุฒูู',  // ุงูุนููุงู
    'ุงูููุชุฌ "ุญุฐุงุก ุฑูุงุถู" ุฃูุดู ุนูู ุงูููุงุฐ (ูุชุจูู 2 ููุท)',  // ุงูุฑุณุงูุฉ
    '/admin/products/edit/123',  // ุงูุฑุงุจุท
    null  // ูุนุฑู ุงูุทูุจ (ุงุฎุชูุงุฑู)
);
```

### ุชุบููุฑ ูุฏุฉ ุงููุญุต:

ูู `public/assets/js/notifications.js`:
```javascript
setInterval(checkNotifications, 30000); // 30 ุซุงููุฉ
// ุบููุฑ 30000 ุฅูู ุงููุฏุฉ ุงููุทููุจุฉ ุจุงููููู ุซุงููุฉ
```

### ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ:

```php
$notificationModel = new Notification();
$notificationModel->deleteOld(30); // ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงูุฃูุฏู ูู 30 ููู
```

---

## ๐ฏ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุฅุดุนุงุฑ ุทูุจ ุฌุฏูุฏ
```php
$notificationModel->create(
    'new_order',
    'ุทูุจ ุฌุฏูุฏ #INV-20251107-ABC123',
    'ุชู ุงุณุชูุงู ุทูุจ ุฌุฏูุฏ ูู ุฃุญูุฏ ูุญูุฏ ุจูููุฉ 450.00 EGP',
    '/admin/orders/view/45',
    45
);
```

### ูุซุงู 2: ุฅุดุนุงุฑ ุชุญุฏูุซ ุญุงูุฉ
```php
$notificationModel->create(
    'order_status',
    'ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ #INV-20251107-ABC123',
    'ุชู ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ ุฅูู "ุชู ุงูุดุญู"',
    '/admin/orders/view/45',
    45
);
```

### ูุซุงู 3: ุฅุดุนุงุฑ ููุงุฐ ูุฎุฒูู
```php
$notificationModel->create(
    'low_stock',
    'ุชุญุฐูุฑ: ููุงุฐ ุงููุฎุฒูู',
    'ุงูููุชุฌ "ุญุฐุงุก ุฑูุงุถู ุฃุฏูุฏุงุณ" ูุชุจูู ููู 2 ูุทุนุฉ ููุท',
    '/admin/products/edit/123',
    null
);
```

---

## ๐ ุฅุญุตุงุฆูุงุช

### ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ:
```php
$count = $notificationModel->getUnreadCount();
echo "ูุฏูู {$count} ุฅุดุนุงุฑ ุฌุฏูุฏ";
```

### ุฌูุจ ุขุฎุฑ 10 ุฅุดุนุงุฑุงุช:
```php
$notifications = $notificationModel->getAll(10);
```

---

## ๐ ุงูุฃูุงู

- โ ุฌููุน ุงูู Routes ูุญููุฉ ุจู `requireAdmin()`
- โ ุงุณุชุฎุฏุงู Prepared Statements ูููุน SQL Injection
- โ ุชูุธูู ุงูุจูุงูุงุช ูุจู ุงูุนุฑุถ
- โ CSRF Protection ุนูู ุฌููุน POST Requests

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุฅุดุนุงุฑุงุช

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชูููุฐ ููู `notifications.sql`
2. ุชุญูู ูู Console ูู ุงููุชุตูุญ (F12)
3. ุชุฃูุฏ ูู ุฃู JavaScript ูุนูู ุจุฏูู ุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุนูู ุงูุตูุช

**ุงูุญู:**
- ุงูุตูุช ูุญุชุงุฌ ุชูุงุนู ุงููุณุชุฎุฏู ุฃููุงู
- ุงุถุบุท ูู ุฃู ููุงู ุจุงูุตูุญุฉ ุซู ุฌุฑุจ ูุฑุฉ ุฃุฎุฑู

### ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ูุง ุชุชุญุฏุซ ุชููุงุฆูุงู

**ุงูุญู:**
- ุชุญูู ูู Console ููุฃุฎุทุงุก
- ุชุฃูุฏ ูู ุฃู `/admin/notifications` ูุนูู
- ุงูุชุญ ุงูุฑุงุจุท ูุจุงุดุฑุฉ ููุชุญูู

---

## ๐ ููุงุญุธุงุช

- ุงูุฅุดุนุงุฑุงุช ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูููู ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ ุฏูุฑูุงู
- ุงููุธุงู ูุฏุนู ุฅุถุงูุฉ ุฃููุงุน ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ ุจุณูููุฉ
- ุงูุชุตููู ูุชุฌุงูุจ ููุนูู ุนูู ุงูููุจุงูู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-11-07  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงููุทูุฑ:** Algebry
